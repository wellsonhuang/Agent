<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Page Prompt-Injection Scanner</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 28px; max-width: 900px; }
    input[type="text"] { width: 80%; padding: 8px; }
    button { padding: 8px 12px; }
    .segment { padding: 10px; margin: 8px 0; border-radius: 6px; }
    .benign { background:#e6ffed; border:1px solid #b7f0c7; }
    .injection { background:#ffecec; border:1px solid #ffb3b3; }
    .unknown { background:#f0f0f0; border:1px solid #ddd; }
    .meta { font-size: 12px; color:#666; margin-bottom:6px; }
  </style>
</head>
<body>
  <h1>Web Page Prompt-Injection Scanner</h1>
  <p>Enter a webpage URL, and we will fetch the page, analyze it segment by segment, and highlight any suspicious content.</p>

  <div>
    <input id="url" type="text" placeholder="https://example.com/article" />
    <button id="scanBtn">Scan Page</button>
  </div>

  <div id="status" style="margin-top:12px"></div>
  <div id="results" style="margin-top:18px"></div>

  <script>
    document.getElementById("scanBtn").onclick = async () => {
      const url = document.getElementById("url").value.trim();
      if (!url) return alert("Please enter a URL");
      document.getElementById("status").textContent = "⏳ Fetching and scanning...";
      document.getElementById("results").innerHTML = "";

      try {
        const res = await fetch("/scan", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({url})
        });
        if (!res.ok) {
          const txt = await res.text();
          document.getElementById("status").textContent = "Error: " + txt;
          return;
        }
        const data = await res.json();
        document.getElementById("status").textContent = `Scanned ${data.segments.length} segments from ${data.url}`;

        const container = document.getElementById("results");
        data.segments.forEach((seg, idx) => {
          const div = document.createElement("div");
          div.className = "segment " + (seg.label || "unknown");
          const meta = document.createElement("div");
          meta.className = "meta";
          meta.textContent = `#${idx+1} — label: ${seg.label} — raw_label: ${seg.raw_label} — score: ${seg.score.toFixed(3)}`;
          const p = document.createElement("div");
          p.innerText = seg.text;
          div.appendChild(meta);
          div.appendChild(p);
          container.appendChild(div);
        });
      } catch (e) {
        console.error(e);
        document.getElementById("status").textContent = "Error: " + e;
      }
    };
  </script>
</body>
</html>
